<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL映射文件名称：游戏
	————————————————————————————————————
	修改日期		作者		变更内容
	20190506	唐永刚	    创建了该文件
	————————————————————————————————————
	陕西佳之易网络科技有限公司 版本所有
 -->

<mapper namespace="com.jzy.api.dao.app.AppGameMapper">

    <!--    前台渠道商对应商品查询区-->
    <select id="getAreaInfo" resultType="com.jzy.api.po.app.AppGameListPo">
        SELECT
            ag.id,
            ag.p_id AS pId,
            ag. NAME
        FROM
            app_info ai
        LEFT JOIN app_game ag ON ai.game_id = ag.p_id
        WHERE
            ai.id = #{aiId}
        AND ag.type = 2
        AND ai. STATUS = 1
    </select>

    <!--  前台渠道商对应商品查询服  -->
    <select id="getServInfo" resultType="com.jzy.api.po.app.AppGameListPo">
        SELECT
            ag.id,
            ag.p_id AS pId,
            ag. NAME
        FROM
            app_game ag
        WHERE ag.type = 3

        <if test="areaId!=null and areaId!=0">
            AND ag.p_id = #{areaId}
        </if>
        <if test="areaId==null or areaId==0">
            AND ag.p_id = (SELECT id FROM app_game WHERE p_id = (SELECT game_id FROM app_info where id = #{aiId} LIMIT 1) LIMIT 1)
        </if>
    </select>

    <!--    校验当前商品是否存在区-->
    <select id="checkAreaInfo" resultType="com.jzy.api.po.app.AppGameListPo">
          SELECT
            ag.id,
            ag.p_id AS pId,
            ag. NAME
        FROM
            app_game ag
        WHERE
            ag.p_id = #{pid}
        AND ag.type = 2
        and NAME != '无'
        AND NAME != ' '

    </select>

    <!--    校验当前商品是否存在服-->
    <select id="checkServInfo" resultType="com.jzy.api.po.app.AppGameListPo">
        SELECT
        ag.id,
        ag.p_id AS pId,
        ag. NAME
        FROM
        app_game ag
        WHERE
        ag.type = 3
        and NAME != '无'
        AND NAME != ' '
        and
        ag.p_id in
        <foreach collection="ids" index="index" separator="," open="(" close=")"
                 item="item">
            #{item}
        </foreach>

    </select>


    <!--    后台游戏列表查询-->

    <select id="getList" parameterType="com.jzy.api.cnd.app.GameListCnd"
            resultType="com.jzy.api.po.app.AppGamePo">
        select
        game.id,
        game.p_id as pId,
        game.`name`,
        game.type
        FROM
        app_game game
        WHERE
        1 = 1
        AND game.p_id = #{pId}
        AND game.type =#{type}
        <if test="queryName!=null">
            AND game. NAME LIKE CONCAT('%', #{queryName}, '%')
        </if>


    </select>

</mapper>
