<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL映射文件名称：订单处理
	————————————————————————————————————
	修改日期		作者		变更内容
	20190426	邓冲	    创建了该文件
	————————————————————————————————————
	陕西佳之易网络科技有限公司 版本所有
 -->

<mapper namespace="com.jzy.api.dao.biz.OrderMapper">
    
    <resultMap id="order" type="com.jzy.api.model.biz.Order">
        <result column="id" property="orderId" />
        <result column="code" property="code" />
        <result column="out_trade_no" property="outTradeNo" />
        <result column="user_id" property="userId" />
        <result column="app_id" property="appId" />
        <result column="sup_no" property="supNo" />
        <result column="sup_price" property="supPrice" />
        <result column="sup_status" property="supStatus" />
        <result column="discount" property="discount" />
        <result column="price" property="price" />
        <result column="number" property="number" />
        <result column="status" property="status" />
        <result column="type" property="type" />
        <result column="total_fee" property="totalFee" />
        <result column="price_type_name" property="priceTypeName" />
        <result column="price_type_unit" property="priceTypeUnit" />
        <result column="acct_type" property="acctType" />
        <result column="account" property="account" />
        <result column="game_account" property="gameAccount" />
        <result column="game_area" property="gameArea" />
        <result column="game_serv" property="gameServ" />
        <result column="trade_method" property="tradeMethod" />
        <result column="trade_fee" property="tradeFee" />
        <result column="trade_status" property="tradeStatus" />
        <result column="invoice_status" property="invoiceStatus" />
        <result column="remark" property="remark" />
        <result column="recharge_mode" property="rechargeMode" />
        <result column="dealer_id" property="dealerId" />
        <result column="del_flag" property="delFlag" />
        <result column="creator_id" property="creatorId" />
        <result column="modifier_id" property="modifierId" />
        <result column="create_time" property="createTime" />
        <result column="modify_time" property="modifyTime" />
    </resultMap>

    <!-- 新增订单 -->
    <insert id="insert" parameterType="com.jzy.api.model.biz.Order">
        INSERT INTO `order`(
        id, code, out_trade_no, user_id, app_id, sup_no, sup_price, sup_status, discount,
        price, number, status, type, total_fee, price_type_name, price_type_unit,
        acct_type, account, game_account, game_area, game_serv, trade_method, trade_code,
        trade_fee, trade_status, invoice_status, remark, recharge_mode, dealer_id,
        del_flag, creator_id, modifier_id, create_time, modify_time
        )
        VALUES (
        #{orderId}, #{code}, #{outTradeNo}, #{userId}, #{appId}, #{supNo}, #{supPrice}, #{supStatus}, #{discount},
        #{price}, #{number}, #{status}, #{type}, #{totalFee}, #{priceTypeName}, #{priceTypeUnit},
        #{acctType}, #{account}, #{gameAccount}, #{gameArea}, #{gameServ}, #{tradeMethod}, #{tradeCode},
        #{tradeFee}, #{tradeStatus}, #{invoiceStatus}, #{remark}, #{rechargeMode}, #{dealerId},
        #{delFlag}, #{creatorId}, #{modifierId}, #{createTime}, #{modifyTime}
        )
    </insert>

    <!-- 更新订单 -->
    <update id="update" parameterType="com.jzy.api.model.biz.Order">
        UPDATE
        `order`
        SET
        sup_status = #{supStatus},
        status = #{status},
        trade_method = #{tradeMethod},
        trade_code = #{tradeCode},
        trade_fee = #{tradeFee},
        trade_status = #{tradeStatus},
        del_flag = #{delFlag},
        invoice_status = #{invoiceStatus},
        remark = #{remark},
        <include refid="updateCommon" />
        WHERE
        id = #{orderId}
    </update>

    <!-- 删除订单 -->
    <update id="updateOrderDelFlag">

    </update>

    <!-- 根据订单id查询订单详情 -->
    <select id="queryOrderById" resultMap="order">
        SELECT
        id, code, out_trade_no, user_id, app_id, sup_no, sup_price, sup_status, discount,
        price, number, status, type, total_fee, price_type_name, price_type_unit,
        acct_type, account, game_account, game_area, game_serv, trade_method, trade_code,
        trade_fee, trade_status, invoice_status, remark, recharge_mode, dealer_id,
        create_time, modify_time
        FROM
        `order`
        WHERE
        id = #{orderId}
    </select>

    <!-- 订单列表查询 -->
    <select id="queryOrderList" resultType="com.jzy.api.model.biz.Order">

    </select>

    <!-- 根据订单id查询卡密 -->
    <select id="queryCardPwdById" resultType="java.lang.String">

    </select>

    <!-- 根据订单id关闭订单 -->
    <update id="updateOrderClose">

    </update>

    <!-- 更新订单状态 -->
    <update id="updateStatus">
        UPDATE
        `order`
        SET
        status = #{status}
        WHERE
        id = #{id}
    </update>

    <!-- 更新订单交易状态 -->
    <update id="updateTradeStatus">
        UPDATE
        `order`
        SET
        trade_status = #{tradeStatus}
        WHERE
        id = #{id}
    </update>

    <!-- 更新支付状态 -->
    <update id="updateStatusTradeStatusSupStatus">
        UPDATE
        `order`
        SET
        status = #{status},
        trade_status = #{tradeStatus},
        sup_status = #{supStatus}
        WHERE
        id = #{id}
    </update>

    <update id="updateStatusTrade">
        UPDATE
        `order`
        SET
        status = #{status},
        trade_code = #{tradeCode},
        trade_fee = #{tradeFee},
        trade_status = #{tradeStatus}
        WHERE
        id = #{id}
    </update>

    <update id="updateStatusSupStatusTrade">
        UPDATE
        `order`
        SET
        status = #{status},
        sup_status = #{supStatus},
        trade_code = #{tradeCode},
        trade_fee = #{tradeFee},
        trade_status = #{tradeStatus}
        WHERE
        id = #{id}
    </update>

    <!-- 更新订单的支付方式，流水号，交易状态 -->
    <update id="updateStatusTradeMethod">
        UPDATE
        `order`
        SET
        status = #{status},
        trade_method = #{tradeMethod},
        out_trade_no = #{outTradeNo}
        WHERE
        id = #{id}
    </update>

    <!-- 更新sup状态 -->
    <update id="updateSupStatus">
        UPDATE
        `order`
        SET
        sup_status = #{supStatus}
        WHERE
        id = #{id}
    </update>

    <!-- 共同更新参数 -->
    <sql id="updateCommon">
        modifier_id = #{modifierId}, modify_time = #{modifyTime}
    </sql>

</mapper>